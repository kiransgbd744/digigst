package com.ey.advisory.app.services.jobs.erp;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Repository;

import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import jakarta.persistence.Query;

@Repository("Get2ASFTPConsoForSectionDaoImpl")
public class Get2ASFTPConsoForSectionDaoImpl
		implements Get2ASFTPConsoForSectionDao {

	@PersistenceContext(unitName = "clientDataUnit")
	private EntityManager manager;
	private static final Logger LOGGER = LoggerFactory
			.getLogger(Get2ASFTPConsoForSectionDaoImpl.class);

	public List<Object[]> findSFTPGet2AConsoForSection(final String gstin,
			final String retPeriod, final String section, final Long batchId,
			final Long erpBatchId) {
		List<Object[]> objs = new ArrayList<>();
		try {
			String sql = getQuery(section);
			Query q = manager.createNativeQuery(sql);
			q.setParameter("gstin", gstin);
			q.setParameter("retPeriod", retPeriod);
			q.setParameter("batchId", batchId);
			q.setParameter("erpBatchId", erpBatchId);
			objs = q.getResultList();
		} catch (Exception e) {
			LOGGER.error("Exception Occured:", e);
		}
		return objs;
	}

	public String getQuery(String section) {
		StringBuilder sql = new StringBuilder();
		if ("B2B".equalsIgnoreCase(section)) {
			return "  SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE,DOC_NUM,DOC_DATE, "
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT ,CESS_AMT, "
					+ " TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM, "
					+ " BOF_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME , "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT, "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM,INV_DATE, "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE, "
					+ " RCHRG,GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG , "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,ECOM_GSTIN, "
					+ " MERCHANT_ID,INITIATED_DATE,INITIATED_TIME,DERIVED_RET_PERIOD,  "
					+ " IRN_NUM,IRN_GEN_DATE,IRN_SOURCE_TYPE  "
					+ " FROM( SELECT TAX_PERIOD RETURN_PERIOD,CGSTIN,SGSTIN, "
					+ " LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,'B2B' DOC_TYPE,INV_TYPE SUPPLY_TYPE,  "
					+ " 'B2B' TABLE_TYPE,SUPPLIER_INV_NUM DOC_NUM,SUPPLIER_INV_DATE DOC_DATE,  "
					+ " SUM(IFNULL(ITM.TAX_VALUE,0)) TAXABLE_VALUE,TAX_RATE,  "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,  "
					+ " SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT,  "
					+ " SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,  "
					+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,  "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0) +IFNULL(ITM.SGST_AMT,0)  "
					+ " +IFNULL(ITM.CESS_AMT,0)) AS TOTAL_TAX,  "
					+ " SUPPLIER_INV_VAL AS INVOICE_VALUE, + POS,STATE_NAME, "
					+ " '' PORT_CODE,'' BOE_NUM,'' BOF_CREATED_DATE,'' BOE_REF_DATE, "
					+ " '' IS_AMENDMENT_BOE ,'' ORIGINAL_SUPPLIER_GSTIN, "
					+ " '' ORIGINAL_SUPPLIER_TRADENAME,'' ORIGINAL_PORT_CODE , "
					+ " '' ORIGINAL_BILL_OF_ENTRY_NUMBER,'' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT ,'' ORG_DOC_NUM, "
					+ " '' ORG_DOC_DATE,'' INV_NUM,'' INV_DATE, "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,  "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND HDR.FILE_PERIOD IS NOT NULL  "
					+ " THEN 'Y' ELSE 'N' END) GSTR1_FILING_STATUS , "
					+ " HDR.FILE_DATE GSTR1_FILING_DATE,HDR.FILE_PERIOD GSTR1_FILING_PERIOD , "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS,HDR.CANCEL_DATE CANCELLATION_DATE , "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL  "
					+ " AND HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)  "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST,'' ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER, "
					+ " '' ECOM_GSTIN,'' MERCHANT_ID , "
					+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME,HDR.DERIVED_RET_PERIOD, "
					+ " HDR.IRN_NUM,HDR.IRN_GEN_DATE,HDR.IRN_SOURCE_TYPE  "
					+ " FROM GETGSTR2A_B2B_HEADER HDR INNER JOIN GETGSTR2A_B2B_ITEM ITM  "
					+ " ON HDR.ID = ITM.HEADER_ID AND  "
					+ " HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME FROM TBL_VENDOR_MASTER_CONFIG  "
					+ " WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD ON HDR.SGSTIN = VD.GSTIN  "
					+ " LEFT JOIN MASTER_STATE SC ON HDR.POS = SC.STATE_CODE  "
					+ " WHERE HDR.IS_DELETE = FALSE AND IS_SENT_TO_ERP=false  "
					+ " AND CGSTIN =:gstin  "
					+ " AND TAX_PERIOD =:retPeriod  "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId  "
					+ " "
					+ " AND DELTA_INV_STATUS IN ('N','M','D') GROUP BY  "
					+ " TAX_PERIOD,CFS,CGSTIN,SGSTIN,LEGAL_NAME_BS,TRADE_NAME,SUPPLIER_INV_VAL,SUPPLIER_INV_NUM,  "
					+ " SUPPLIER_INV_DATE,TAX_RATE, "
					+ " ITM.TAX_VALUE,ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT,  "
					+ " POS,STATE_NAME, "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,HDR.FILE_DATE, "
					+ " HDR.FILE_PERIOD,HDR.CANCEL_DATE ,HDR.CFS_GSTR3B,DIFF_PERCENT, "
					+ " ITEM_NUMBER,HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE, "
					+ " HDR.IRN_NUM,HDR.IRN_GEN_DATE,HDR.IRN_SOURCE_TYPE) ";
		} else if ("B2BA".equalsIgnoreCase(section)) {

			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE , "
					+ " TABLE_TYPE,DOC_NUM,DOC_DATE,TAXABLE_VALUE, TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT ,  "
					+ " CESS_AMT,TOTAL_TAX, INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM, BOE_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME ,  "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER,  "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE,  "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT,  "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM,  "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,   "
					+ " GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD,  "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG ,  "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,ECOM_GSTIN,  "
					+ " MERCHANT_ID ,INITIATED_DATE, INITIATED_TIME,  "
					+ " DERIVED_RET_PERIOD FROM( SELECT TAX_PERIOD RETURN_PERIOD,  "
					+ " CGSTIN,SGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,'B2BA' DOC_TYPE,  "
					+ " INV_TYPE SUPPLY_TYPE, 'B2BA' TABLE_TYPE,SUPPLIER_INV_NUM DOC_NUM,  "
					+ " SUPPLIER_INV_DATE DOC_DATE, SUM(IFNULL(ITM.TAX_VALUE,0))   "
					+ " TAXABLE_VALUE,TAX_RATE, SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,   "
					+ " SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT, "
					+ " SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,   "
					+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,   "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0)   "
					+ " +IFNULL(ITM.SGST_AMT,0) +IFNULL(ITM.CESS_AMT,0))   "
					+ " AS TOTAL_TAX,  + SUPPLIER_INV_VAL AS INVOICE_VALUE,  "
					+ " POS,STATE_NAME,'' PORT_CODE,'' BOE_NUM,  "
					+ " '' BOE_CREATED_DATE,'' BOE_REF_DATE,'' IS_AMENDMENT_BOE ,  "
					+ " '' ORIGINAL_SUPPLIER_GSTIN,'' ORIGINAL_SUPPLIER_TRADENAME,  "
					+ " '' ORIGINAL_PORT_CODE ,'' ORIGINAL_BILL_OF_ENTRY_NUMBER,  "
					+ " '' ORIGINAL_BILL_OF_ENTRY_DATE,'' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,  "
					+ " '' ORIGINAL_TAXABLE_VALUE,'' ORIGINAL_IGST_AMOUNT,  "
					+ " '' ORIGINAL_CESS_AMOUNT ,HDR.ORG_INV_NUM ORG_DOC_NUM,  "
					+ " HDR.ORG_INV_DATE ORG_DOC_DATE,'' INV_NUM,'' INV_DATE ,  "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,   "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND   "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)   "
					+ " GSTR1_FILING_STATUS ,HDR.FILE_DATE GSTR1_FILING_DATE,  "
					+ " HDR.FILE_PERIOD GSTR1_FILING_PERIOD ,  "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS,  "
					+ " HDR.CANCEL_DATE CANCELLATION_DATE ,  "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND   "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)   "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST,  "
					+ " '' ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,'' ECOM_GSTIN,  "
					+ " '' MERCHANT_ID , TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE,  "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME,  "
					+ " HDR.DERIVED_RET_PERIOD FROM GETGSTR2A_B2BA_HEADER   "
					+ " HDR INNER JOIN GETGSTR2A_B2BA_ITEM ITM   "
					+ " ON HDR.ID = ITM.HEADER_ID AND  HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD   "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN,  "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME FROM TBL_VENDOR_MASTER_CONFIG   "
					+ " WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD   "
					+ " ON HDR.SGSTIN = VD.GSTIN   "
					+ " LEFT JOIN MASTER_STATE SC ON HDR.POS = SC.STATE_CODE   "
					+ " WHERE HDR.IS_DELETE = FALSE AND IS_SENT_TO_ERP=false "
					+ " AND CGSTIN =:gstin   "
					+ " AND TAX_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId  "
					+ " "
					+ " AND DELTA_INV_STATUS IN ('N','M','D') "
					+ " GROUP BY TAX_PERIOD,  "
					+ " CFS,CGSTIN,SGSTIN,LEGAL_NAME_BS,TRADE_NAME,SUPPLIER_INV_VAL,SUPPLIER_INV_NUM,   "
					+ " SUPPLIER_INV_DATE,TAX_RATE,ITM.TAX_VALUE,  "
					+ " ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT, POS,STATE_NAME,  "
					+ " HDR.ORG_INV_NUM,HDR.ORG_INV_DATE,   "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,HDR.FILE_DATE,  "
					+ " HDR.FILE_PERIOD,HDR.CANCEL_DATE ,HDR.CFS_GSTR3B,DIFF_PERCENT,  "
					+ " ITEM_NUMBER,HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE) "; 
			
		} else if ("CDN".equalsIgnoreCase(section)) {
			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, "
					+ " DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE, + DOC_NUM,DOC_DATE, "
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT ,CESS_AMT, "
					+ " TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM, "
					+ " BOE_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME , "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT, "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM, "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,  "
					+ " GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG , "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER, "
					+ " ECOM_GSTIN,MERCHANT_ID ,INITIATED_DATE, INITIATED_TIME, "
					+ " DERIVED_RET_PERIOD, IRN_NUM,IRN_GEN_DATE,IRN_SOURCE_TYPE  "
					+ " FROM( SELECT TAX_PERIOD RETURN_PERIOD, "
					+ " HDR.CTIN CGSTIN,HDR.GSTIN SGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,  "
					+ " (CASE WHEN NOTE_TYPE = 'C' THEN 'CN' "
					+ " WHEN NOTE_TYPE = 'D' THEN 'DN' END) DOC_TYPE, "
					+ " NOTE_TYPE SUPPLY_TYPE, 'CDN' TABLE_TYPE, "
					+ " NOTE_NUMBER DOC_NUM,NOTE_DATE DOC_DATE,  "
					+ " SUM(IFNULL(ITM.TAX_VALUE,0)) TAXABLE_VALUE,TAX_RATE,  "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,  "
					+ " SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT,  "
					+ " SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,  "
					+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,  "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0)  "
					+ " +IFNULL(ITM.SGST_AMT,0) +IFNULL(ITM.CESS_AMT,0))  "
					+ " AS TOTAL_TAX,  "
					+ " NOTE_VALUE AS INVOICE_VALUE, POS,STATE_NAME,'' PORT_CODE,'' BOE_NUM, "
					+ " '' BOE_CREATED_DATE,'' BOE_REF_DATE,'' IS_AMENDMENT_BOE , "
					+ " '' ORIGINAL_SUPPLIER_GSTIN,'' ORIGINAL_SUPPLIER_TRADENAME, "
					+ " '' ORIGINAL_PORT_CODE ,'' ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT ,  "
					+ " '' ORG_DOC_NUM,'' ORG_DOC_DATE,INV_NUMBER INV_NUM, "
					+ " INV_DATE INV_DATE ,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,  "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND  "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)  "
					+ " GSTR1_FILING_STATUS ,HDR.FILE_DATE GSTR1_FILING_DATE, "
					+ " HDR.FILE_PERIOD GSTR1_FILING_PERIOD , "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS,HDR.CANCEL_DATE CANCELLATION_DATE , "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND  "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)  "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST,'' ITC_ELIGIBLE, "
					+ " DIFF_PERCENT,ITEM_NUMBER,'' ECOM_GSTIN,'' MERCHANT_ID , "
					+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, SUBSTR(HDR.CREATED_ON,12) "
					+ " INITIATED_TIME,HDR.DERIVED_RET_PERIOD,  "
					+ " HDR.IRN_NUM,HDR.IRN_GEN_DATE,HDR.IRN_SOURCE_TYPE  "
					+ " FROM GETGSTR2A_CDN_HEADER HDR INNER JOIN  "
					+ " GETGSTR2A_CDN_ITEM ITM ON HDR.ID = ITM.HEADER_ID  "
					+ " AND HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME  "
					+ " FROM TBL_VENDOR_MASTER_CONFIG WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled')  "
					+ " AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD ON HDR.GSTIN = VD.GSTIN  "
					+ " LEFT JOIN MASTER_STATE SC  "
					+ " ON HDR.POS = SC.STATE_CODE WHERE HDR.IS_DELETE = FALSE  "
					+ " AND IS_SENT_TO_ERP=false  "
					+ " AND CTIN =:gstin  AND TAX_PERIOD =:retPeriod AND "
					+ " HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId "
					+ " AND DELTA_INV_STATUS IN ('N','M','D') GROUP BY TAX_PERIOD, "
					+ " CFS,CTIN,HDR.GSTIN,LEGAL_NAME_BS,TRADE_NAME,NOTE_TYPE,NOTE_VALUE, "
					+ " NOTE_NUMBER,NOTE_DATE,TAX_RATE , "
					+ " ITM.TAX_VALUE,ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT, "
					+ " POS,STATE_NAME,INV_NUMBER, "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG, "
					+ " HDR.FILE_DATE,HDR.FILE_PERIOD,HDR.CANCEL_DATE , "
					+ " HDR.CFS_GSTR3B,DIFF_PERCENT,ITEM_NUMBER, "
					+ " HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE, "
					+ " HDR.IRN_NUM,HDR.IRN_GEN_DATE,HDR.IRN_SOURCE_TYPE) ";

		} else if ("CDNA".equalsIgnoreCase(section)) {
			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE,DOC_NUM,DOC_DATE, "
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT , "
					+ " CESS_AMT,TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE, "
					+ " BOE_NUM,BOE_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME , "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT, "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM, "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,  "
					+ " GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE, "
					+ " CDN_DELINKING_FLAG ,CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT, "
					+ " ITEM_NUMBER,ECOM_GSTIN,MERCHANT_ID ,INITIATED_DATE,  "
					+ " INITIATED_TIME,DERIVED_RET_PERIOD  "
					+ " FROM( SELECT TAX_PERIOD RETURN_PERIOD,HDR.CTIN CGSTIN, "
					+ " HDR.GSTIN SGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,  "
					+ " (CASE WHEN NOTE_TYPE = 'C' THEN 'CNA' WHEN NOTE_TYPE = 'D'  "
					+ " THEN 'DNA' END) DOC_TYPE, "
					+ " NOTE_TYPE SUPPLY_TYPE, 'CDNA' TABLE_TYPE,NOTE_NUMBER DOC_NUM, "
					+ " NOTE_DATE DOC_DATE, SUM(IFNULL(ITM.TAX_VALUE,0))  "
					+ " TAXABLE_VALUE,TAX_RATE, SUM(IFNULL(ITM.IGST_AMT,0))  "
					+ " IGST_AMT, SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT,  "
					+ " SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,  "
					+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,  "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0)  "
					+ " +IFNULL(ITM.SGST_AMT,0) +IFNULL(ITM.CESS_AMT,0))  "
					+ " AS TOTAL_TAX, NOTE_VALUE AS INVOICE_VALUE, "
					+ " POS,STATE_NAME,'' PORT_CODE,'' BOE_NUM,'' BOE_CREATED_DATE, "
					+ " '' BOE_REF_DATE,'' IS_AMENDMENT_BOE ,'' ORIGINAL_SUPPLIER_GSTIN, "
					+ " '' ORIGINAL_SUPPLIER_TRADENAME,'' ORIGINAL_PORT_CODE , "
					+ " '' ORIGINAL_BILL_OF_ENTRY_NUMBER,'' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT , "
					+ " ORG_NOTE_NUMBER ORG_DOC_NUM,ORG_NOTE_DATE ORG_DOC_DATE, "
					+ " INV_NUMBER INV_NUM,INV_DATE INV_DATE ,ORG_INV_AMD_PERIOD, "
					+ " ORG_INV_AMD_TYPE,RCHRG, (CASE WHEN HDR.FILE_DATE IS NOT NULL  "
					+ " AND HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)  "
					+ " GSTR1_FILING_STATUS ,HDR.FILE_DATE GSTR1_FILING_DATE, "
					+ " HDR.FILE_PERIOD GSTR1_FILING_PERIOD , "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS, "
					+ " HDR.CANCEL_DATE CANCELLATION_DATE , "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND  "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END)  "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST,'' ITC_ELIGIBLE, "
					+ " DIFF_PERCENT,ITEM_NUMBER,'' ECOM_GSTIN,'' MERCHANT_ID , "
					+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12)  "
					+ " INITIATED_TIME,HDR.DERIVED_RET_PERIOD  "
					+ " FROM GETGSTR2A_CDNA_HEADER HDR INNER JOIN GETGSTR2A_CDNA_ITEM   "
					+ " ITM ON HDR.ID = ITM.HEADER_ID  "
					+ " AND HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME  "
					+ " FROM TBL_VENDOR_MASTER_CONFIG WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled')  "
					+ " AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD ON HDR.GSTIN = VD.GSTIN  "
					+ " LEFT JOIN MASTER_STATE SC  "
					+ " ON HDR.POS = SC.STATE_CODE WHERE HDR.IS_DELETE = FALSE   AND Ctin=:gstin  AND TAX_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId AND DELTA_INV_STATUS IN ('N','M','D') "
					+ " GROUP BY TAX_PERIOD,CFS, "
					+ " CTIN,HDR.GSTIN,LEGAL_NAME_BS,TRADE_NAME,NOTE_TYPE,NOTE_NUMBER,NOTE_VALUE, "
					+ " NOTE_DATE,TAX_RATE , ITM.TAX_VALUE,ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT, "
					+ " POS,STATE_NAME,ORG_NOTE_NUMBER, "
					+ " ORG_NOTE_DATE,INV_NUMBER,INV_DATE ,ORG_INV_AMD_PERIOD, "
					+ " ORG_INV_AMD_TYPE,RCHRG,HDR.FILE_DATE,HDR.FILE_PERIOD , "
					+ " HDR.CANCEL_DATE,HDR.CFS_GSTR3B,DIFF_PERCENT,ITEM_NUMBER, "
					+ " HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE) ";
		} else if ("ISD".equalsIgnoreCase(section)) {
		
		return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE, "
				+ " DOC_NUM,DOC_DATE,TAXABLE_VALUE, TAX_RATE, "
				+ " IGST_AMT,CGST_AMT,SGST_AMT ,CESS_AMT,TOTAL_TAX, "
				+ " INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM,BOE_CREATED_DATE , "
				+ " BOE_REF_DATE,IS_AMENDMENT_BOE ,ORIGINAL_SUPPLIER_GSTIN, "
				+ " ORIGINAL_SUPPLIER_TRADENAME ,ORIGINAL_PORT_CODE, "
				+ " ORIGINAL_BILL_OF_ENTRY_NUMBER,ORIGINAL_BILL_OF_ENTRY_DATE , "
				+ " ORIGINAL_BILL_OF_ENTRY_REF_DATE,ORIGINAL_TAXABLE_VALUE, "
				+ " ORIGINAL_IGST_AMOUNT,ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM, "
				+ " ORG_DOC_DATE,INV_NUM,INV_DATE,ORG_INV_AMD_PERIOD, "
				+ " ORG_INV_AMD_TYPE,RCHRG, GSTR1_FILING_STATUS, "
				+ " GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD,GSTR3B_FILING_STATUS, "
				+ " CANCELLATION_DATE,CDN_DELINKING_FLAG ,CR_DR_PRE_GST, "
				+ " ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,ECOM_GSTIN, "
				+ " MERCHANT_ID ,INITIATED_DATE, INITIATED_TIME, "
				+ " DERIVED_RET_PERIOD FROM( SELECT RET_PERIOD RETURN_PERIOD, "
				+ " HDR.GSTIN SGSTIN,HDR.CTIN CGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME, "
				+ " ISD_DOC_TYPE DOC_TYPE,'' SUPPLY_TYPE, 'ISD' TABLE_TYPE, "
				+ " DOC_NUM,DOC_DATE, 0.00 TAXABLE_VALUE, 0.00 TAX_RATE,  "
				+ " SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT, SUM(IFNULL(ITM.CGST_AMT,0))  "
				+ " CGST_AMT, SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,  "
				+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,  "
				+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0)  "
				+ " +IFNULL(ITM.SGST_AMT,0) +IFNULL(ITM.CESS_AMT,0))  "
				+ " AS TOTAL_TAX, 0.00 INVOICE_VALUE, '' POS,STATE_NAME, "
				+ " '' PORT_CODE,'' BOE_NUM,'' BOE_CREATED_DATE,'' BOE_REF_DATE, "
				+ " '' IS_AMENDMENT_BOE ,'' ORIGINAL_SUPPLIER_GSTIN, "
				+ " '' ORIGINAL_SUPPLIER_TRADENAME,'' ORIGINAL_PORT_CODE , "
				+ " '' ORIGINAL_BILL_OF_ENTRY_NUMBER, "
				+ " '' ORIGINAL_BILL_OF_ENTRY_DATE, "
				+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE , "
				+ " '' ORIGINAL_TAXABLE_VALUE,'' ORIGINAL_IGST_AMOUNT, "
				+ " '' ORIGINAL_CESS_AMOUNT ,'' ORG_DOC_NUM,'' ORG_DOC_DATE, "
				+ " '' INV_NUM,'' INV_DATE ,'' ORG_INV_AMD_PERIOD, "
				+ " '' ORG_INV_AMD_TYPE,'' RCHRG,'' GSTR1_FILING_STATUS , "
				+ " '' GSTR1_FILING_DATE,'' GSTR1_FILING_PERIOD, "
				+ " '' GSTR3B_FILING_STATUS,'' CANCELLATION_DATE , "
				+ " '' CDN_DELINKING_FLAG,'' CR_DR_PRE_GST,ITC_ELG ITC_ELIGIBLE, "
				+ " 0 DIFF_PERCENT,0 ITEM_NUMBER,'' ECOM_GSTIN, '' MERCHANT_ID , "
				+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
				+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME, "
				+ " HDR.DERIVED_RET_PERIOD FROM GETGSTR2A_ISD_HEADER  "
				+ " HDR INNER JOIN GETGSTR2A_ISD_ITEM ITM ON HDR.ID = ITM.HEADER_ID  "
				+ " AND HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
				+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN,LEGAL_NAME  "
				+ " AS LEGAL_NAME_BS,TRADE_NAME FROM TBL_VENDOR_MASTER_CONFIG  "
				+ " WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE)  "
				+ " VD ON HDR.GSTIN = VD.GSTIN LEFT JOIN MASTER_STATE SC  "
				+ " ON SUBSTR(HDR.GSTIN,1,2) = SC.STATE_CODE WHERE HDR.IS_DELETE = FALSE   "
				+ " AND  HDR.GSTIN=:gstin  AND RET_PERIOD =:retPeriod "
				+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId  "
				+ " AND DELTA_INV_STATUS IN ('N','M','D') "
				+ " GROUP BY  RET_PERIOD,CFS,CTIN,HDR.GSTIN,LEGAL_NAME_BS,TRADE_NAME, ISD_DOC_TYPE,DOC_NUM,DOC_DATE, "
				+ " ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT,ITC_ELG ,STATE_NAME, "
				+ " HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD) ";
		
		} else if ("IMPG".equalsIgnoreCase(section)) {
			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, "
					+ " DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE,DOC_NUM,DOC_DATE, "
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT , "
					+ " CESS_AMT,TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE, "
					+ " BOE_NUM,BOE_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME , "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT, "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM, "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG,  "
					+ " GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG , "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER, "
					+ " ECOM_GSTIN,MERCHANT_ID ,INITIATED_DATE, INITIATED_TIME, "
					+ " DERIVED_RET_PERIOD FROM( SELECT RET_PERIOD RETURN_PERIOD, "
					+ " HDR.GSTIN CGSTIN,'' SGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,  "
					+ " 'IMPG' DOC_TYPE,'R' SUPPLY_TYPE,'IMPG' TABLE_TYPE,'' DOC_NUM, "
					+ " '' DOC_DATE, SUM(IFNULL(ITM.TAXABLE_VALUE,0)) TAXABLE_VALUE, "
					+ " 0 TAX_RATE, SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,  "
					+ " 0 CGST_AMT, 0 SGST_AMT, SUM(IFNULL(ITM.CESS_AMT,0))  "
					+ " CESS_AMT, SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CESS_AMT,0))  "
					+ " AS TOTAL_TAX, 0 INVOICE_VALUE,'' POS,'' STATE_NAME,  "
					+ " PORT_CODE,BOE_NUM,BOE_CREATED_DATE,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " '' ORIGINAL_SUPPLIER_GSTIN,'' ORIGINAL_SUPPLIER_TRADENAME, "
					+ " '' ORIGINAL_PORT_CODE ,'' ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT , "
					+ " '' ORG_DOC_NUM,'' ORG_DOC_DATE,'' INV_NUM,'' INV_DATE, "
					+ " '' ORG_INV_AMD_PERIOD,'' ORG_INV_AMD_TYPE , '' GSTR1_FILING_STATUS,'' GSTR1_FILING_DATE, "
					+ " '' GSTR1_FILING_PERIOD ,'' RCHRG ,'' GSTR3B_FILING_STATUS, "
					+ " '' CANCELLATION_DATE,'' CDN_DELINKING_FLAG , "
					+ " '' CR_DR_PRE_GST,'' ITC_ELIGIBLE,0 DIFF_PERCENT, "
					+ " 0 ITEM_NUMBER,'' ECOM_GSTIN,'' MERCHANT_ID , "
					+ "TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME,HDR.DERIVED_RET_PERIOD  "
					+ " FROM GETGSTR2A_IMPG_HEADER HDR INNER JOIN GETGSTR2A_IMPG_ITEM  "
					+ " ITM ON HDR.ID = ITM.HEADER_ID AND  "
					+ " HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME "
					+ " FROM TBL_VENDOR_MASTER_CONFIG WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') "
					+ " AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD ON HDR.GSTIN = VD.GSTIN  "
					+ " WHERE HDR.IS_DELETE = FALSE   "
					+ " AND HDR.GSTIN =:gstin  AND RET_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId "
					+ "  AND DELTA_INV_STATUS IN ('N','M','D') "
					+ " GROUP BY  RET_PERIOD,HDR.GSTIN,LEGAL_NAME_BS,TRADE_NAME,PORT_CODE, "
					+ " BOE_NUM,BOE_CREATED_DATE,ITM.TAXABLE_VALUE, "
					+ " ITM.IGST_AMT,ITM.CESS_AMT, "
					+ " BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD) ";
		
		} else if ("IMPGSEZ".equalsIgnoreCase(section)) {
		
			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, "
					+ " DOC_TYPE,SUPPLY_TYPE ,TABLE_TYPE,DOC_NUM,DOC_DATE, "
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT , "
					+ " CESS_AMT,TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE, "
					+ " BOE_NUM,BOE_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME , "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT,ORIGINAL_CESS_AMOUNT , "
					+ " ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM,INV_DATE,ORG_INV_AMD_PERIOD, "
					+ " ORG_INV_AMD_TYPE,RCHRG, GSTR1_FILING_STATUS,GSTR1_FILING_DATE , "
					+ " GSTR1_FILING_PERIOD,GSTR3B_FILING_STATUS,CANCELLATION_DATE, "
					+ " CDN_DELINKING_FLAG ,CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT, "
					+ " ITEM_NUMBER,ECOM_GSTIN,MERCHANT_ID ,INITIATED_DATE,  "
					+ " INITIATED_TIME,DERIVED_RET_PERIOD  "
					+ " FROM( SELECT RET_PERIOD RETURN_PERIOD, "
					+ " HDR.GSTIN CGSTIN,SGSTIN,LEGAL_NAME_BS LEGAL_NAME,VD.TRADE_NAME, "
					+ " 'IMPGSEZ' DOC_TYPE,'R' SUPPLY_TYPE,'IMPGSEZ' TABLE_TYPE,'' DOC_NUM, "
					+ " '' DOC_DATE, SUM(IFNULL(ITM.TAXABLE_VALUE,0)) TAXABLE_VALUE, "
					+ " 0 TAX_RATE, SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,  "
					+ " 0 CGST_AMT, 0 SGST_AMT, SUM(IFNULL(ITM.CESS_AMT,0))  "
					+ " CESS_AMT, SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CESS_AMT,0))  "
					+ " AS TOTAL_TAX, 0 INVOICE_VALUE,'' POS,'' STATE_NAME,  "
					+ " PORT_CODE,BOE_NUM,BOE_CREATED_DATE,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " '' ORIGINAL_SUPPLIER_GSTIN,'' ORIGINAL_SUPPLIER_TRADENAME, "
					+ " '' ORIGINAL_PORT_CODE ,'' ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT , "
					+ " '' ORG_DOC_NUM,'' ORG_DOC_DATE,'' INV_NUM,'' INV_DATE, "
					+ " '' ORG_INV_AMD_PERIOD,'' ORG_INV_AMD_TYPE ,'' RCHRG, "
					+ " '' GSTR1_FILING_STATUS,'' GSTR1_FILING_DATE, "
					+ " '' GSTR1_FILING_PERIOD ,'' GSTR3B_FILING_STATUS, "
					+ " '' CANCELLATION_DATE,'' CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST, "
					+ " '' ITC_ELIGIBLE,0 DIFF_PERCENT,0 ITEM_NUMBER, "
					+ " '' ECOM_GSTIN,'' MERCHANT_ID , "
					+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME,HDR.DERIVED_RET_PERIOD  "
					+ " FROM GETGSTR2A_IMPGSEZ_HEADER HDR INNER JOIN  "
					+ " GETGSTR2A_IMPGSEZ_ITEM ITM ON HDR.ID = ITM.HEADER_ID  "
					+ " AND HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD  "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME  "
					+ " FROM TBL_VENDOR_MASTER_CONFIG WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled')  "
					+ " AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD ON HDR.SGSTIN = VD.GSTIN  "
					+ " WHERE HDR.IS_DELETE = FALSE   "
					+ " AND HDR.GSTIN =:gstin  AND RET_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId "
					+ " AND DELTA_INV_STATUS IN ('N','M','D')  "
					+ " GROUP BY RET_PERIOD, "
					+ " HDR.GSTIN,SGSTIN,LEGAL_NAME_BS,VD.TRADE_NAME,ITM.TAXABLE_VALUE, "
					+ " ITM.IGST_AMT,ITM.CESS_AMT, "
					+ " PORT_CODE,BOE_NUM,BOE_CREATED_DATE,BOE_REF_DATE, "
					+ " IS_AMENDMENT_BOE ,HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD) ";
		} else if ("ECOM".equalsIgnoreCase(section)) {

			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE, "
					+ " TABLE_TYPE,DOC_NUM,DOC_DATE,"
					+ " TAXABLE_VALUE,TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT ,CESS_AMT, "
					+ " TOTAL_TAX,INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM, "
					+ " BOF_CREATED_DATE ,BOE_REF_DATE,IS_AMENDMENT_BOE , "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME, "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT, "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM,INV_DATE, "
					+ " ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE, "
					+ " RCHRG,GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG, "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,ECOM_GSTIN, "
					+ " MERCHANT_ID,INITIATED_DATE,INITIATED_TIME,DERIVED_RET_PERIOD, "
					+ " IRN_NUM,IRN_GEN_DATE,IRN_SOURCE_TYPE "
					+ " FROM( SELECT TAX_PERIOD RETURN_PERIOD,CGSTIN,SGSTIN, "
					+ " LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,'ECOM' DOC_TYPE,INV_TYPE SUPPLY_TYPE, "
					+ " 'ECOM' TABLE_TYPE,SUPPLIER_INV_NUM DOC_NUM,SUPPLIER_INV_DATE DOC_DATE, "
					+ " SUM(IFNULL(ITM.TAX_VALUE,0)) TAXABLE_VALUE,TAX_RATE, "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT,SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT, "
					+ " SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT, "
					+ " SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0) +IFNULL(ITM.SGST_AMT,0) "
					+ " + IFNULL(ITM.CESS_AMT,0)) AS TOTAL_TAX, "
					+ " SUPPLIER_INV_VAL AS INVOICE_VALUE, + POS,STATE_NAME, "
					+ " '' PORT_CODE,'' BOE_NUM,'' BOF_CREATED_DATE,'' BOE_REF_DATE, "
					+ " '' IS_AMENDMENT_BOE ,'' ORIGINAL_SUPPLIER_GSTIN, "
					+ " '' ORIGINAL_SUPPLIER_TRADENAME,'' ORIGINAL_PORT_CODE, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_NUMBER,'' ORIGINAL_BILL_OF_ENTRY_DATE, "
					+ " '' ORIGINAL_TAXABLE_VALUE,'' ORIGINAL_IGST_AMOUNT,  "
					+ " '' ORIGINAL_BILL_OF_ENTRY_REF_DATE ,'' ORIGINAL_TAXABLE_VALUE, "
					+ " '' ORIGINAL_IGST_AMOUNT,'' ORIGINAL_CESS_AMOUNT ,'' ORG_DOC_NUM, "
					+ " '' ORG_DOC_DATE,'' INV_NUM,'' INV_DATE, "
					+ " NULL AS ORG_INV_AMD_PERIOD,NULL AS ORG_INV_AMD_TYPE,RCHRG, "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND HDR.FILE_PERIOD IS NOT NULL"
					+ " THEN 'Y' ELSE 'N' END) GSTR1_FILING_STATUS ,"
					+ " HDR.FILE_DATE GSTR1_FILING_DATE,HDR.FILE_PERIOD GSTR1_FILING_PERIOD, "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS,HDR.CANCEL_DATE CANCELLATION_DATE, "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL "
					+ " AND HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END) "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST,'' ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER, "
					+ " '' ECOM_GSTIN,'' MERCHANT_ID , "
					+ " TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME,HDR.DERIVED_RET_PERIOD, "
					+ " NULL AS IRN_NUM,NULL AS IRN_GEN_DATE,NULL AS IRN_SOURCE_TYPE "
					+ " FROM GETGSTR2A_ECOM_HEADER HDR INNER JOIN GETGSTR2A_ECOM_ITEM ITM "
					+ " ON HDR.ID = ITM.HEADER_ID AND "
					+ " HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME FROM TBL_VENDOR_MASTER_CONFIG "
					+ " WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') AND IS_ACTIVE = TRUE "
					+ " AND IS_FETCHED = TRUE) VD ON HDR.SGSTIN = VD.GSTIN "
					+ " LEFT JOIN MASTER_STATE SC ON HDR.POS = SC.STATE_CODE "
					+ " WHERE HDR.IS_DELETE = FALSE AND IS_SENT_TO_ERP=false "
					+ " AND CGSTIN =:gstin "
					+ " AND TAX_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId "
					+ " "
					+ " AND DELTA_INV_STATUS IN ('N','M','D') GROUP BY "
					+ " TAX_PERIOD,CFS,CGSTIN,SGSTIN,LEGAL_NAME_BS,TRADE_NAME,SUPPLIER_INV_VAL,SUPPLIER_INV_NUM, "
					+ " SUPPLIER_INV_DATE,TAX_RATE, "
					+ " ITM.TAX_VALUE,ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT, "
					+ " POS,STATE_NAME,RCHRG,HDR.FILE_DATE, "
					+ " HDR.FILE_PERIOD,HDR.CANCEL_DATE ,HDR.CFS_GSTR3B,DIFF_PERCENT, "
					+ " ITEM_NUMBER,HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE) " ; 
			
		} else if ("ECOMA".equalsIgnoreCase(section)) {

			return " SELECT RETURN_PERIOD,CGSTIN,SGSTIN,LEGAL_NAME,TRADE_NAME, DOC_TYPE,SUPPLY_TYPE, "
					+ " TABLE_TYPE,DOC_NUM,DOC_DATE,TAXABLE_VALUE, TAX_RATE,IGST_AMT,CGST_AMT,SGST_AMT, "
					+ " CESS_AMT,TOTAL_TAX, INVOICE_VALUE,POS,STATE_NAME,PORT_CODE,BOE_NUM, BOE_CREATED_DATE, "
					+ " BOE_REF_DATE,IS_AMENDMENT_BOE, "
					+ " ORIGINAL_SUPPLIER_GSTIN,ORIGINAL_SUPPLIER_TRADENAME, "
					+ " ORIGINAL_PORT_CODE,ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " ORIGINAL_BILL_OF_ENTRY_DATE ,ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " ORIGINAL_TAXABLE_VALUE,ORIGINAL_IGST_AMOUNT,  "
					+ " ORIGINAL_CESS_AMOUNT ,ORG_DOC_NUM,ORG_DOC_DATE,INV_NUM, "
					+ " INV_DATE,ORG_INV_AMD_PERIOD,ORG_INV_AMD_TYPE,RCHRG, "
					+ " GSTR1_FILING_STATUS,GSTR1_FILING_DATE ,GSTR1_FILING_PERIOD, "
					+ " GSTR3B_FILING_STATUS,CANCELLATION_DATE,CDN_DELINKING_FLAG, "
					+ " CR_DR_PRE_GST,ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,ECOM_GSTIN, "
					+ " MERCHANT_ID ,INITIATED_DATE, INITIATED_TIME, "
					+ " DERIVED_RET_PERIOD FROM( SELECT TAX_PERIOD RETURN_PERIOD, "
					+ " CGSTIN,SGSTIN,LEGAL_NAME_BS LEGAL_NAME,TRADE_NAME,'ECOMA' DOC_TYPE, "
					+ " INV_TYPE SUPPLY_TYPE, 'ECOMA' TABLE_TYPE,SUPPLIER_INV_NUM DOC_NUM, "
					+ " SUPPLIER_INV_DATE DOC_DATE, SUM(IFNULL(ITM.TAX_VALUE,0)) "
					+ " TAXABLE_VALUE,TAX_RATE, SUM(IFNULL(ITM.IGST_AMT,0)) IGST_AMT, "
					+ " SUM(IFNULL(ITM.CGST_AMT,0)) CGST_AMT,SUM(IFNULL(ITM.SGST_AMT,0)) SGST_AMT,  "
					+ " SUM(IFNULL(ITM.CESS_AMT,0)) CESS_AMT,SUM(IFNULL(ITM.IGST_AMT,0)+IFNULL(ITM.CGST_AMT,0) "
					+ " + IFNULL(ITM.SGST_AMT,0) +IFNULL(ITM.CESS_AMT,0)) "
					+ " AS TOTAL_TAX,  + SUPPLIER_INV_VAL AS INVOICE_VALUE, "
					+ " POS,STATE_NAME,'' PORT_CODE,'' BOE_NUM, "
					+ " '' BOE_CREATED_DATE,'' BOE_REF_DATE,'' IS_AMENDMENT_BOE, "
					+ " '' ORIGINAL_SUPPLIER_GSTIN,'' ORIGINAL_SUPPLIER_TRADENAME, "
					+ " '' ORIGINAL_PORT_CODE ,'' ORIGINAL_BILL_OF_ENTRY_NUMBER, "
					+ " '' ORIGINAL_BILL_OF_ENTRY_DATE,'' ORIGINAL_BILL_OF_ENTRY_REF_DATE, "
					+ " '' ORIGINAL_TAXABLE_VALUE,'' ORIGINAL_IGST_AMOUNT, "
					+ " '' ORIGINAL_CESS_AMOUNT ,HDR.ORG_INV_NUM ORG_DOC_NUM, "
					+ " HDR.ORG_INV_DATE ORG_DOC_DATE,'' INV_NUM,'' INV_DATE, "
					+ " NULL AS ORG_INV_AMD_PERIOD,NULL AS ORG_INV_AMD_TYPE,RCHRG, "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END) "
					+ " GSTR1_FILING_STATUS ,HDR.FILE_DATE GSTR1_FILING_DATE, "
					+ " HDR.FILE_PERIOD GSTR1_FILING_PERIOD, "
					+ " HDR.CFS_GSTR3B GSTR3B_FILING_STATUS, "
					+ " HDR.CANCEL_DATE CANCELLATION_DATE, "
					+ " (CASE WHEN HDR.FILE_DATE IS NOT NULL AND "
					+ " HDR.FILE_PERIOD IS NOT NULL THEN 'Y' ELSE 'N' END) "
					+ " CDN_DELINKING_FLAG ,'' CR_DR_PRE_GST, "
					+ " '' ITC_ELIGIBLE,DIFF_PERCENT,ITEM_NUMBER,'' ECOM_GSTIN, "
					+ " '' MERCHANT_ID , TO_CHAR(HDR.CREATED_ON,'DD-MM-YYYY') INITIATED_DATE, "
					+ " SUBSTR(HDR.CREATED_ON,12) INITIATED_TIME, "
					+ " HDR.DERIVED_RET_PERIOD FROM GETGSTR2A_ECOMA_HEADER "
					+ " HDR INNER JOIN GETGSTR2A_ECOMA_ITEM ITM "
					+ " ON HDR.ID = ITM.HEADER_ID AND  HDR.DERIVED_RET_PERIOD = ITM.DERIVED_RET_PERIOD "
					+ " LEFT JOIN (SELECT DISTINCT VENDOR_GSTIN AS GSTIN, "
					+ " LEGAL_NAME AS LEGAL_NAME_BS,TRADE_NAME FROM TBL_VENDOR_MASTER_CONFIG "
					+ " WHERE GSTIN_STATUS IN ('Active','Suspended','Cancelled') AND IS_ACTIVE = TRUE AND IS_FETCHED = TRUE) VD "
					+ " ON HDR.SGSTIN = VD.GSTIN "
					+ " LEFT JOIN MASTER_STATE SC ON HDR.POS = SC.STATE_CODE "
					+ " WHERE HDR.IS_DELETE = FALSE AND IS_SENT_TO_ERP=false "
					+ " AND CGSTIN =:gstin "
					+ " AND TAX_PERIOD =:retPeriod "
					+ " AND HDR.BATCH_ID =:batchId AND ERP_BATCH_ID =:erpBatchId "
					+ " "
					+ " AND DELTA_INV_STATUS IN ('N','M','D') "
					+ " GROUP BY TAX_PERIOD, "
					+ " CFS,CGSTIN,SGSTIN,LEGAL_NAME_BS,TRADE_NAME,SUPPLIER_INV_VAL,SUPPLIER_INV_NUM, "
					+ " SUPPLIER_INV_DATE,TAX_RATE,ITM.TAX_VALUE, "
					+ " ITM.IGST_AMT,ITM.CGST_AMT,ITM.SGST_AMT,ITM.CESS_AMT, POS,STATE_NAME, "
					+ " HDR.ORG_INV_NUM,HDR.ORG_INV_DATE, "
					+ " RCHRG,HDR.FILE_DATE, "
					+ " HDR.FILE_PERIOD,HDR.CANCEL_DATE ,HDR.CFS_GSTR3B,DIFF_PERCENT, "
					+ " ITEM_NUMBER,HDR.CREATED_ON,HDR.DERIVED_RET_PERIOD,INV_TYPE) "; 
			
		}
		return sql.toString();
	}
}
